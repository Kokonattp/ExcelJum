<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ExcelJum - ‡∏ù‡∏∂‡∏Å‡∏à‡∏≥‡∏™‡∏π‡∏ï‡∏£ Excel</title>
    
    <!-- Google Fonts: Prompt -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Variables & Theme --- */
        :root {
            --font-main: 'Prompt', sans-serif;
            
            /* Modern Palette - More natural greens */
            --primary: #2e7d32;
            --primary-light: #4caf50;
            --primary-dark: #1b5e20;
            --on-primary: #ffffff;
            
            --secondary: #546e7a;
            --secondary-bg: #eceff1;
            
            /* Surface & Backgrounds */
            --bg-color: #f4f7f6;
            --surface: #ffffff;
            --surface-variant: #f8f9fa;
            
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            
            --border: #e0e0e0;
            --border-hover: #bdbdbd;

            /* Category Colors (Soft Pastel) */
            --tag-basic-bg: #e3f2fd; --tag-basic-text: #1565c0;
            --tag-lookup-bg: #ede7f6; --tag-lookup-text: #5e35b1;
            --tag-condition-bg: #fff3e0; --tag-condition-text: #e65100;
            --tag-text-bg: #fce4ec; --tag-text-text: #c2185b;
            --tag-date-bg: #e0f2f1; --tag-date-text: #00695c;

            /* Effects */
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.06);
            --shadow-lg: 0 16px 48px rgba(0,0,0,0.08);
            
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 32px;
        }

        [data-theme="dark"] {
            --primary: #81c784;
            --primary-light: #a5d6a7;
            --primary-dark: #388e3c;
            --on-primary: #003300;
            
            --bg-color: #121212;
            --surface: #1e1e1e;
            --surface-variant: #2c2c2c;
            
            --text-main: #e0e0e0;
            --text-secondary: #a0a0a0;
            
            --border: #333333;
            --border-hover: #555555;
            
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.2);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.3);
            
            /* Dark mode tags */
            --tag-basic-bg: #1e3a5f; --tag-basic-text: #90caf9;
            --tag-lookup-bg: #322a55; --tag-lookup-text: #b39ddb;
            --tag-condition-bg: #4a2c0b; --tag-condition-text: #ffcc80;
            --tag-text-bg: #4a1b2f; --tag-text-text: #f48fb1;
            --tag-date-bg: #143e38; --tag-date-text: #80cbc4;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: var(--font-main);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            /* Subtle background mesh */
            background-image: 
                radial-gradient(at 0% 0%, rgba(var(--primary), 0.05) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(52, 152, 219, 0.05) 0px, transparent 50%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.4s ease;
        }

        /* Enforce Font */
        input, button, textarea, select, code, pre {
            font-family: var(--font-main) !important;
        }

        .app-container {
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--bg-color); /* Seamless transition on desktop */
        }
        
        @media (min-width: 501px) {
            .app-container {
                background: var(--surface);
                box-shadow: var(--shadow-lg);
                border-left: 1px solid var(--border);
                border-right: 1px solid var(--border);
            }
        }

        /* --- Header --- */
        header {
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.01); /* Almost transparent */
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.03);
        }

        h1 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.02em;
        }

        .logo-box {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 800;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        main {
            flex: 1;
            padding: 20px 24px 110px 24px;
            overflow-y: auto;
            scrollbar-width: none;
        }
        main::-webkit-scrollbar { display: none; }

        /* --- Common Components --- */
        .btn-icon {
            background: var(--surface-variant);
            border: none;
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-icon:active { transform: scale(0.92); }

        .btn {
            height: 48px;
            padding: 0 32px;
            border-radius: 16px;
            border: none;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:active { transform: scale(0.96); }

        .btn-filled {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 14px rgba(46, 125, 50, 0.25);
        }
        .btn-filled:hover { background: var(--primary-dark); }
        
        .btn-outlined {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-secondary);
        }
        .btn-outlined:hover { border-color: var(--primary); color: var(--primary); }

        .card {
            background: var(--surface);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm); 
            border: 1px solid var(--border);
            transition: transform 0.2s;
        }

        /* --- Bottom Nav (Floating Style) --- */
        .bottom-nav-container {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 48px);
            max-width: 450px;
            z-index: 100;
        }

        .bottom-nav {
            background: rgba(var(--surface), 0.9);
            background: var(--surface);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            display: flex;
            justify-content: space-between;
            padding: 12px 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            width: 48px;
            padding: 0;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: var(--primary);
            font-weight: 600;
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .nav-item.active svg {
            transform: translateY(-2px);
        }

        /* --- Flashcard (Smoother) --- */
        .flashcard-container {
            perspective: 1500px;
            width: 100%;
            height: 400px; /* Reduced height for better proportion */
            margin: 16px 0;
            position: relative;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.2, 0.8, 0.2, 1);
            cursor: pointer;
        }

        .flashcard.flipped { transform: rotateY(180deg); }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--radius-lg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 32px;
            box-shadow: var(--shadow-md);
            text-align: center;
            background: var(--surface);
            border: 1px solid var(--border);
        }

        .card-front {
            /* Dot pattern */
            background-image: radial-gradient(var(--border) 1.5px, transparent 1.5px);
            background-size: 24px 24px;
        }

        .card-back {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            transform: rotateY(180deg);
            border: none;
        }

        .category-chip {
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 24px;
            letter-spacing: 0.5px;
            /* Colors set inline via JS based on type */
        }

        .flashcard-actions {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 24px;
        }

        .action-btn {
            width: 64px;
            height: 64px;
            border-radius: 24px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: var(--surface);
        }

        .action-btn:active { transform: scale(0.9); box-shadow: var(--shadow-sm); }
        .btn-reject { color: #ef5350; }
        .btn-accept { color: #4caf50; background: #e8f5e9; }

        /* Refined Filters */
        .filters {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 4px 24px 12px 24px;
            margin: 0 -24px 8px -24px;
            scrollbar-width: none;
        }
        .filters::-webkit-scrollbar { display: none; }
        .filters::after { content: ''; padding-right: 24px; }

        .filter-chip {
            padding: 8px 18px;
            border-radius: 100px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-secondary);
            white-space: nowrap;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: var(--text-main);
            color: var(--surface);
            border-color: var(--text-main);
        }

        /* --- Quiz UI (Cleaner) --- */
        .quiz-option {
            width: 100%;
            padding: 20px 24px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: var(--surface);
            color: var(--text-main);
            text-align: left;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .quiz-option:hover {
            border-color: var(--primary);
            background: var(--surface-variant);
        }
        .quiz-option:active { transform: scale(0.98); }

        .quiz-option.correct {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-color: #a5d6a7;
        }
        .quiz-option.wrong {
            background-color: #ffebee;
            color: #c62828;
            border-color: #ef9a9a;
        }

        .quiz-progress {
            height: 6px;
            background-color: var(--border);
            border-radius: 10px;
            margin-bottom: 32px;
            overflow: hidden;
        }

        .quiz-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            width: 0%;
            transition: width 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* --- Parser UI (Visual Tree) --- */
        .parser-input {
            width: 100%;
            padding: 24px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background-color: var(--surface);
            color: var(--text-main);
            font-size: 16px;
            margin-bottom: 20px;
            min-height: 140px;
            transition: all 0.2s;
            resize: vertical;
            line-height: 1.6;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        .parser-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.1);
        }

        .tree-view {
            background-color: var(--surface-variant);
            padding: 24px;
            border-radius: 20px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 2;
            position: relative;
        }
        
        /* Connecting Lines Logic */
        .tree-line {
            position: relative;
            padding-left: 20px;
        }
        .tree-line::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--border);
        }
        .tree-line::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 14px;
            height: 2px;
            background-color: var(--border);
        }

        /* --- Profile UI --- */
        .profile-header {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 32px;
            padding: 40px 24px;
            text-align: center;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .level-badge {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd700, #ffca28); /* Gold gradient default */
            color: #5d4037;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 56px;
            margin: 0 auto 20px auto;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            border: 4px solid var(--surface);
        }
        
        /* --- Toast --- */
        #toast {
            visibility: hidden;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            text-align: center;
            border-radius: 50px;
            padding: 14px 28px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            top: 80px; /* Top notification looks cleaner */
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Animation Classes */
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 0.3s, transform 0.3s; }
        
        /* Helper for hiding */
        .hidden { display: none !important; }
    </style>
</head>
<body data-theme="light">
    <div class="app-container">
        <!-- Header -->
        <header>
            <h1>
                <div class="logo-box">X</div>
                ExcelJum
            </h1>
            <button class="btn-icon" id="theme-toggle" aria-label="Toggle Theme">
                <!-- Sun/Moon Icon -->
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
            </button>
        </header>

        <!-- Main Content -->
        <main>
            <!-- 1. Flashcard Section -->
            <section id="tab-flashcard">
                <div class="filters" id="category-filters">
                    <button class="filter-chip active" data-cat="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button class="filter-chip" data-cat="basic">‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</button>
                    <button class="filter-chip" data-cat="lookup">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    <button class="filter-chip" data-cat="condition">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</button>
                    <button class="filter-chip" data-cat="text">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                    <button class="filter-chip" data-cat="datetime">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
                </div>

                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard">
                        <div class="card-face card-front">
                            <span class="category-chip" id="fc-category">‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</span>
                            <h2 style="font-size: 24px; line-height: 1.5; color: var(--text-main); max-width: 80%;" id="fc-question">?</h2>
                            <p style="margin-top:auto; font-size:13px; color:var(--text-secondary); opacity:0.7;">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢</p>
                        </div>
                        <div class="card-face card-back">
                            <h2 style="font-size: 40px; font-weight:800; margin-bottom: 12px; letter-spacing: 0.5px;" id="fc-answer">SUM</h2>
                            <div style="background:rgba(255,255,255,0.15); backdrop-filter:blur(4px); padding:8px 16px; border-radius:12px; margin-bottom:20px; display:inline-block; font-family: var(--font-main); font-size: 14px;" id="fc-syntax">=SUM(...)</div>
                            <p id="fc-desc" style="font-size: 16px; line-height: 1.6; max-width:85%;">‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</p>
                        </div>
                    </div>
                </div>

                <div class="flashcard-actions">
                    <button class="action-btn btn-reject" id="btn-forget" aria-label="‡∏¢‡∏±‡∏á‡∏à‡∏≥‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                    <div style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <span style="font-size:12px; color:var(--text-secondary); margin-bottom:4px;">PROGRESS</span>
                        <strong id="fc-progress" style="font-size:18px; color:var(--text-main);">0/50</strong>
                    </div>
                    <button class="action-btn btn-accept" id="btn-remember" aria-label="‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </button>
                </div>
            </section>

            <!-- 2. Quiz Section -->
            <section id="tab-quiz" class="hidden">
                <div id="quiz-start" style="text-align: center; padding-top: 60px;">
                    <div style="width: 100px; height: 100px; background: #e3f2fd; border-radius: 30px; display:flex; align-items:center; justify-content:center; margin: 0 auto 32px auto; font-size:48px; color:#1565c0; transform: rotate(-5deg);">
                        üìù
                    </div>
                    <h2 style="font-size: 28px; margin-bottom: 12px;">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥</h2>
                    <p style="color:var(--text-secondary); margin-bottom: 40px; font-size: 15px; line-height: 1.6;">10 ‡∏Ç‡πâ‡∏≠‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ Excel ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<br>‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏£‡∏±‡∏ö XP ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
                    <button class="btn btn-filled" onclick="startQuiz()" style="width: 100%;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                </div>

                <div id="quiz-game" class="hidden">
                    <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:12px;">
                        <span style="font-size:12px; font-weight:700; color:var(--text-secondary); letter-spacing:1px;">QUESTION</span>
                        <span id="quiz-counter" style="font-size:16px; font-weight:700; color:var(--primary);">1/10</span>
                    </div>
                    <div class="quiz-progress"><div class="quiz-bar" id="quiz-bar"></div></div>
                    
                    <h3 style="margin-bottom:32px; font-size: 22px; line-height: 1.5; color:var(--text-main);" id="quiz-question">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...</h3>

                    <div id="quiz-options"></div>
                    
                    <div id="quiz-feedback" class="card hidden" style="background-color: var(--surface); border-color: var(--border);">
                        <p id="quiz-feedback-text" style="font-size: 16px; line-height: 1.6;"></p>
                        <button class="btn btn-filled" onclick="nextQuestion()" style="width:100%; margin-top: 16px;">‡πÑ‡∏õ‡∏ï‡πà‡∏≠</button>
                    </div>
                </div>

                <div id="quiz-result" class="hidden" style="text-align: center; padding-top: 40px;">
                    <h2 style="margin-bottom: 24px;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                    <div class="level-badge" style="width: 140px; height: 140px; font-size: 48px; border-width: 6px;" id="quiz-score-badge">8/10</div>
                    <h3 id="quiz-rank-text" style="color:var(--primary); font-size: 24px; margin-bottom: 8px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h3>
                    <p style="color:var(--text-secondary);">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö +<span id="quiz-xp-gain" style="font-weight:700; color:var(--text-main);">0</span> XP</p>
                    
                    <div style="display:flex; gap:16px; justify-content:center; margin-top:40px;">
                        <button class="btn btn-outlined" onclick="resetQuizUI()" style="flex:1;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                        <button class="btn btn-filled" onclick="startQuiz()" style="flex:1;">‡∏ó‡∏≥‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                    </div>
                </div>
            </section>

            <!-- 3. Parser Section -->
            <section id="tab-parser" class="hidden">
                <h2 style="margin-bottom: 8px;">‡πÅ‡∏õ‡∏•‡∏™‡∏π‡∏ï‡∏£ Excel</h2>
                <p style="color:var(--text-secondary); font-size:14px; margin-bottom:24px;">‡∏ß‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á</p>
                
                <textarea class="parser-input" id="formula-input" placeholder="‡∏ß‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏ä‡πà‡∏ô =VLOOKUP(...)"></textarea>
                
                <div class="example-chips" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:24px;">
                    <button class="filter-chip" onclick="setExample('=SUM(A1:A10)')">SUM</button>
                    <button class="filter-chip" onclick="setExample('=VLOOKUP(H5,Data!A:C,3,0)')">VLOOKUP</button>
                    <button class="filter-chip" onclick="setExample('=IF(A1>50, &quot;Pass&quot;, &quot;Fail&quot;)')">IF</button>
                </div>

                <button class="btn btn-filled" onclick="parseFormula()" style="width:100%; margin-bottom:32px;">
                    üîç ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢
                </button>

                <div id="parser-result" class="hidden">
                    <div style="margin-bottom:24px;">
                        <h3 style="font-size:12px; text-transform:uppercase; letter-spacing:1px; color:var(--text-secondary); margin-bottom:8px;">SUMMARY</h3>
                        <p id="parser-summary" style="font-size: 16px; font-weight:500; color:var(--text-main);">...</p>
                    </div>

                    <h3 style="font-size:12px; text-transform:uppercase; letter-spacing:1px; color:var(--text-secondary); margin-bottom:12px;">STRUCTURE</h3>
                    <div class="tree-view" id="parser-tree"></div>
                </div>
            </section>

            <!-- 4. Profile Section -->
            <section id="tab-profile" class="hidden">
                <div class="profile-header">
                    <div class="level-badge" id="profile-badge">üìö</div>
                    <h2 id="profile-level" style="font-size: 22px; color: var(--text-main); margin-bottom: 8px;">Level 1: Newbie</h2>
                    
                    <div style="background:var(--surface-variant); height:8px; border-radius:10px; overflow:hidden; margin: 24px 0 12px 0;">
                        <div id="xp-bar" style="background:var(--primary); height:100%; width:0%; transition: width 1s ease;"></div>
                    </div>
                    <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:600; color:var(--text-secondary);">
                        <span>XP: <span id="profile-xp">0</span></span>
                        <span>Next: <span id="profile-next-xp">100</span></span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 32px;">
                    <div class="card" style="margin:0; text-align:center; padding: 20px;">
                        <div class="stat-value" id="stat-learned" style="font-size:32px; color:var(--text-main);">0</div>
                        <div style="font-size:12px; color:var(--text-secondary); margin-top:4px;">Learned</div>
                    </div>
                    <div class="card" style="margin:0; text-align:center; padding: 20px;">
                        <div class="stat-value" id="stat-streak" style="font-size:32px; color:#e65100;">0</div>
                        <div style="font-size:12px; color:var(--text-secondary); margin-top:4px;">Day Streak</div>
                    </div>
                </div>

                <h3 style="font-size:16px; margin-bottom:16px;">Achievements</h3>
                <div class="achievement-list" id="achievement-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                    <!-- Dynamic rendering -->
                </div>

                <div style="margin-top: 48px; text-align: center;">
                    <button style="background:none; border:none; color:var(--text-secondary); font-size:13px; text-decoration:underline; cursor:pointer;" onclick="resetData()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </section>
        </main>

        <!-- Toast Notification -->
        <div id="toast">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>

        <!-- Navigation -->
        <div class="bottom-nav-container">
            <nav class="bottom-nav">
                <button class="nav-item active" onclick="switchTab('flashcard')">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/><path d="M7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/></svg>
                    <span>Cards</span>
                </button>
                <button class="nav-item" onclick="switchTab('quiz')">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm1.07-4.25l-.47.48c-.62.62-1.6 1.77-1.6 3.77h-2c0-2.43 1.28-3.9 2.47-5.08l.92-.93c.36-.36.61-.83.61-1.32 0-1.1-.9-2-2-2s-2 .9-2 2H7c0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.25-.57 2.37-1.43 3.08z"/></svg>
                    <span>Quiz</span>
                </button>
                <button class="nav-item" onclick="switchTab('parser')">
                    <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/></svg>
                    <span>Parser</span>
                </button>
                <button class="nav-item" onclick="switchTab('profile')">
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                    <span>Me</span>
                </button>
            </nav>
        </div>
    </div>

    <script>
        /* --- Database & Logic (Keep same logic, updated rendering) --- */
        const FORMULAS = [
            // ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Basic)
            { id: 1, type: 'basic', q: '‡∏´‡∏≤‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', a: 'SUM', syn: '=SUM(A1:A10)', desc: '‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', opts: ['SUM', 'COUNT', 'ADD'] },
            { id: 2, type: 'basic', q: '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', a: 'AVERAGE', syn: '=AVERAGE(A1:A10)', desc: '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏ì‡∏¥‡∏ï', opts: ['MEAN', 'AVERAGE', 'MEDIAN'] },
            { id: 3, type: 'basic', q: '‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', a: 'COUNT', syn: '=COUNT(A1:A10)', desc: '‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', opts: ['COUNTA', 'COUNT', 'SUM'] },
            { id: 4, type: 'basic', q: '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î', a: 'MAX', syn: '=MAX(A1:A10)', desc: '‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î', opts: ['HIGH', 'MAX', 'TOP'] },
            { id: 5, type: 'basic', q: '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î', a: 'MIN', syn: '=MIN(A1:A10)', desc: '‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î', opts: ['LOW', 'MIN', 'BOTTOM'] },
            { id: 6, type: 'basic', q: '‡∏ô‡∏±‡∏ö‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', a: 'COUNTA', syn: '=COUNTA(A1:A10)', desc: '‡∏ô‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', opts: ['COUNT', 'COUNTA', 'COUNTALL'] },
            { id: 7, type: 'basic', q: '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà K', a: 'LARGE', syn: '=LARGE(A1:A10, 2)', desc: '‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 2', opts: ['MAX', 'LARGE', 'RANK'] },
            { id: 8, type: 'basic', q: '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏ò‡∏¢‡∏ê‡∏≤‡∏ô', a: 'MEDIAN', syn: '=MEDIAN(A1:A10)', desc: '‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', opts: ['AVERAGE', 'MEDIAN', 'MIDDLE'] },
            { id: 9, type: 'basic', q: '‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°', a: 'ROUND', syn: '=ROUND(A1, 2)', desc: '‡∏õ‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', opts: ['ROUND', 'INT', 'FIXED'] },
            { id: 10, type: 'basic', q: '‡∏ú‡∏•‡∏Ñ‡∏π‡∏ì‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', a: 'PRODUCT', syn: '=PRODUCT(A1, B1)', desc: '‡∏Ñ‡∏π‡∏ì‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô', opts: ['MULTIPLY', 'PRODUCT', 'TIMES'] },
            
            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (Lookup)
            { id: 11, type: 'lookup', q: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å (‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á)', a: 'VLOOKUP', syn: '=VLOOKUP(Key, Range, Col, 0)', desc: '‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', opts: ['HLOOKUP', 'VLOOKUP', 'LOOKUP'] },
            { id: 12, type: 'lookup', q: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å (‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)', a: 'HLOOKUP', syn: '=HLOOKUP(Key, Range, Row, 0)', desc: '‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô VLOOKUP ‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô', opts: ['VLOOKUP', 'HLOOKUP', 'SEARCH'] },
            { id: 13, type: 'lookup', q: '‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡πÅ‡∏ñ‡∏ß, ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)', a: 'INDEX', syn: '=INDEX(Range, Row, Col)', desc: '‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤', opts: ['MATCH', 'INDEX', 'FIND'] },
            { id: 14, type: 'lookup', q: '‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á(‡∏•‡∏≥‡∏î‡∏±‡∏ö)‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', a: 'MATCH', syn: '=MATCH(Val, Range, 0)', desc: '‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö', opts: ['INDEX', 'MATCH', 'SEARCH'] },
            { id: 15, type: 'lookup', q: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô ‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤', a: 'INDEX+MATCH', syn: '=INDEX(.., MATCH(..))', desc: '‡∏Ñ‡∏π‡πà‡∏´‡∏π‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á‡∏Å‡∏ß‡πà‡∏≤ VLOOKUP', opts: ['VLOOKUP', 'INDEX+MATCH', 'XLOOKUP'] },
            { id: 16, type: 'lookup', q: '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Next Gen) ‡πÅ‡∏ó‡∏ô VLOOKUP', a: 'XLOOKUP', syn: '=XLOOKUP(Key, LookupArr, ReturnArr)', desc: '‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏ö ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', opts: ['VLOOKUP', 'XLOOKUP', 'FILTER'] },
            { id: 17, type: 'lookup', q: '‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', a: 'FILTER', syn: '=FILTER(Range, Condition)', desc: '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô', opts: ['SORT', 'FILTER', 'QUERY'] },
            { id: 18, type: 'lookup', q: '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', a: 'SORT', syn: '=SORT(Range, Col, Order)', desc: '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å/‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢', opts: ['FILTER', 'ORDER', 'SORT'] },
            { id: 19, type: 'lookup', q: '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô', a: 'UNIQUE', syn: '=UNIQUE(Range)', desc: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏≠‡∏≠‡∏Å', opts: ['DISTINCT', 'UNIQUE', 'SINGLE'] },
            { id: 20, type: 'lookup', q: '‡∏ö‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏•‡∏•‡πå', a: 'ROW', syn: '=ROW(A1)', desc: '‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏Ç‡πÅ‡∏ñ‡∏ß', opts: ['COLUMN', 'ROW', 'LINE'] },

            // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (Condition)
            { id: 21, type: 'condition', q: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡∏à‡∏£‡∏¥‡∏á/‡πÄ‡∏ó‡πá‡∏à', a: 'IF', syn: '=IF(Logic, ValTrue, ValFalse)', desc: '‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô Logic ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', opts: ['IF', 'THEN', 'WHEN'] },
            { id: 22, type: 'condition', q: '‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á "‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠"', a: 'AND', syn: '=AND(Cond1, Cond2)', desc: '‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö IF', opts: ['OR', 'AND', 'NOT'] },
            { id: 23, type: 'condition', q: '‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á"', a: 'OR', syn: '=OR(Cond1, Cond2)', desc: '‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö IF', opts: ['AND', 'OR', 'XOR'] },
            { id: 24, type: 'condition', q: '‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç "‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç"', a: 'SUMIF', syn: '=SUMIF(Range, Crit, SumRange)', desc: '‡∏£‡∏ß‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', opts: ['SUM', 'SUMIF', 'COUNTIF'] },
            { id: 25, type: 'condition', q: '‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô "‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç"', a: 'COUNTIF', syn: '=COUNTIF(Range, Criteria)', desc: '‡∏ô‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', opts: ['COUNT', 'COUNTIF', 'SUMIF'] },
            { id: 26, type: 'condition', q: '‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç "‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç"', a: 'SUMIFS', syn: '=SUMIFS(SumR, CritR1, C1, ...)', desc: '‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ç‡πâ‡∏≠', opts: ['SUMIF', 'SUMIFS', 'DSUM'] },
            { id: 27, type: 'condition', q: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á IF ‡∏ã‡πâ‡∏≠‡∏ô)', a: 'IFS', syn: '=IFS(Cond1, Val1, Cond2, Val2)', desc: 'IF ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢', opts: ['IF', 'IFS', 'SWITCH'] },
            { id: 28, type: 'condition', q: '‡∏ñ‡πâ‡∏≤ Error ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô', a: 'IFERROR', syn: '=IFERROR(Value, ValueIfError)', desc: '‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö #N/A, #VALUE!', opts: ['IFNA', 'IFERROR', 'ISERROR'] },
            { id: 29, type: 'condition', q: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà', a: 'ISBLANK', syn: '=ISBLANK(A1)', desc: '‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ True ‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á', opts: ['ISEMPTY', 'ISBLANK', 'ISNULL'] },
            { id: 30, type: 'condition', q: '‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', a: 'SWITCH', syn: '=SWITCH(Expr, Val1, Res1, ...)', desc: '‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÜ Case ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏°‡∏¥‡πà‡∏á', opts: ['CHOOSE', 'SWITCH', 'IFS'] },

            // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Text)
            { id: 31, type: 'text', q: '‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢', a: 'LEFT', syn: '=LEFT(Text, Num)', desc: '‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤', opts: ['RIGHT', 'LEFT', 'MID'] },
            { id: 32, type: 'text', q: '‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡∏ß‡∏≤', a: 'RIGHT', syn: '=RIGHT(Text, Num)', desc: '‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á', opts: ['LEFT', 'RIGHT', 'END'] },
            { id: 33, type: 'text', q: '‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á', a: 'MID', syn: '=MID(Text, Start, Num)', desc: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', opts: ['CENTER', 'MID', 'SUB'] },
            { id: 34, type: 'text', q: '‡∏ô‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', a: 'LEN', syn: '=LEN(Text)', desc: '‡∏£‡∏ß‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢', opts: ['COUNT', 'LEN', 'SIZE'] },
            { id: 35, type: 'text', q: '‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å', a: 'TRIM', syn: '=TRIM(Text)', desc: '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏≥', opts: ['CLEAN', 'TRIM', 'CUT'] },
            { id: 36, type: 'text', q: '‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô', a: 'CONCATENATE', syn: '=CONCATENATE(A1, " ", B1)', desc: '‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ &', opts: ['JOIN', 'CONCATENATE', 'MERGE'] },
            { id: 37, type: 'text', q: '‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏±‡πà‡∏ô', a: 'TEXTJOIN', syn: '=TEXTJOIN(",", True, Range)', desc: '‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Å‡∏ß‡πà‡∏≤ Concat', opts: ['JOIN', 'TEXTJOIN', 'CONCAT'] },
            { id: 38, type: 'text', q: '‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡πÄ‡∏Å‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà', a: 'SUBSTITUTE', syn: '=SUBSTITUTE(Text, Old, New)', desc: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î', opts: ['REPLACE', 'SUBSTITUTE', 'CHANGE'] },
            { id: 39, type: 'text', q: '‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö)', a: 'TEXT', syn: '=TEXT(Value, Format)', desc: '‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "dd/mm/yy"', opts: ['FORMAT', 'TEXT', 'STRING'] },
            { id: 40, type: 'text', q: '‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', a: 'UPPER', syn: '=UPPER(Text)', desc: 'English Only', opts: ['LOWER', 'UPPER', 'CAPS'] },

            // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Date)
            { id: 41, type: 'datetime', q: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô', a: 'TODAY', syn: '=TODAY()', desc: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô', opts: ['NOW', 'TODAY', 'DATE'] },
            { id: 42, type: 'datetime', q: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô', a: 'NOW', syn: '=NOW()', desc: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì', opts: ['TODAY', 'NOW', 'TIME'] },
            { id: 43, type: 'datetime', q: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å ‡πÄ‡∏•‡∏Ç/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ', a: 'DATE', syn: '=DATE(Year, Month, Day)', desc: '‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', opts: ['MAKE', 'DATE', 'DAY'] },
            { id: 44, type: 'datetime', q: '‡∏î‡∏∂‡∏á‡∏õ‡∏µ ‡∏Ñ.‡∏®. ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤', a: 'YEAR', syn: '=YEAR(Date)', desc: '‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç‡∏õ‡∏µ 4 ‡∏´‡∏•‡∏±‡∏Å', opts: ['YEAR', 'MONTH', 'DAY'] },
            { id: 45, type: 'datetime', q: '‡∏´‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', a: 'DATEDIF', syn: '=DATEDIF(Start, End, "Y")', desc: '‡∏´‡∏≤‡∏≠‡∏≤‡∏¢‡∏∏‡∏á‡∏≤‡∏ô, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏ô', opts: ['DIFF', 'DATEDIF', 'MINUS'] },
            { id: 46, type: 'datetime', q: '‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', a: 'EOMONTH', syn: '=EOMONTH(Date, Months)', desc: '‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', opts: ['ENDDATE', 'EOMONTH', 'LASTDAY'] },
            { id: 47, type: 'datetime', q: '‡∏ö‡∏ß‡∏Å/‡∏•‡∏ö ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', a: 'EDATE', syn: '=EDATE(Date, Months)', desc: '‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å 5 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', opts: ['ADDDATE', 'EDATE', 'NEXT'] },
            { id: 48, type: 'datetime', q: '‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (1-7)', a: 'WEEKDAY', syn: '=WEEKDAY(Date)', desc: '1=Sunday, etc.', opts: ['DAY', 'WEEKDAY', 'WEEK'] },
            { id: 49, type: 'datetime', q: '‡∏ô‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏ï‡∏±‡∏î‡πÄ‡∏™‡∏≤‡∏£‡πå‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå)', a: 'NETWORKDAYS', syn: '=NETWORKDAYS(Start, End)', desc: '‡∏´‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', opts: ['WORKDAY', 'NETWORKDAYS', 'DAYS'] },
            { id: 50, type: 'datetime', q: '‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏á‡∏≤‡∏ô (‡∏ö‡∏ß‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)', a: 'WORKDAY', syn: '=WORKDAY(Start, Days)', desc: '‡∏≠‡∏µ‡∏Å 10 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô', opts: ['NETWORKDAYS', 'WORKDAY', 'DATEADD'] }
        ];

        const PARSER_DB = {
            'SUM': '‡∏´‡∏≤‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', 'AVERAGE': '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', 'COUNT': '‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', 'COUNTA': '‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
            'MAX': '‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î', 'MIN': '‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î', 'LARGE': '‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà K', 'SMALL': '‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà K',
            'VLOOKUP': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á', 'HLOOKUP': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô', 'INDEX': '‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î', 'MATCH': '‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
            'XLOOKUP': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á', 'FILTER': '‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'SORT': '‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö', 'UNIQUE': '‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥',
            'IF': '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'IFS': '‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'AND': '‡πÅ‡∏•‡∏∞ (‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠)', 'OR': '‡∏´‡∏£‡∏∑‡∏≠ (‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á)',
            'SUMIF': '‡∏£‡∏ß‡∏°‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'SUMIFS': '‡∏£‡∏ß‡∏°‡∏ú‡∏•‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'COUNTIF': '‡∏ô‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'IFERROR': '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î Error',
            'LEFT': '‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢', 'RIGHT': '‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏à‡∏≤‡∏Å‡∏Ç‡∏ß‡∏≤', 'MID': '‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á', 'LEN': '‡∏ô‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß',
            'TRIM': '‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á', 'CONCATENATE': '‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'TEXTJOIN': '‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏µ‡∏Ñ‡∏±‡πà‡∏ô', 'SUBSTITUTE': '‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥',
            'TODAY': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô', 'NOW': '‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô', 'DATEDIF': '‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'EOMONTH': '‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
            'NETWORKDAYS': '‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥', 'WORKDAY': '‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', 'ISBLANK': '‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á', 'SWITCH': '‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç'
        };

        const LEVELS = [
            { name: 'Newbie', xp: 0, icon: 'üå±' },
            { name: 'Beginner', xp: 100, icon: 'üåø' },
            { name: 'Intermediate', xp: 300, icon: 'üå≥' },
            { name: 'Advanced', xp: 600, icon: 'üå≤' },
            { name: 'Expert', xp: 1000, icon: 'üíé' },
            { name: 'God Mode', xp: 2000, icon: 'üëë' }
        ];

        const ACHIEVEMENTS = [
            { id: 'start', name: '‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', desc: '‡∏à‡∏≥‡πÑ‡∏î‡πâ 1 ‡∏™‡∏π‡∏ï‡∏£', icon: 'ü•ö', check: (d) => d.learned.length >= 1 },
            { id: 'ten', name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ', desc: '‡∏à‡∏≥‡πÑ‡∏î‡πâ 10 ‡∏™‡∏π‡∏ï‡∏£', icon: 'üê£', check: (d) => d.learned.length >= 10 },
            { id: 'fifty', name: '‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥', desc: '‡∏à‡∏≥‡πÑ‡∏î‡πâ 50 ‡∏™‡∏π‡∏ï‡∏£', icon: 'ü¶Ö', check: (d) => d.learned.length >= 50 },
            { id: 'quiz1', name: '‡∏•‡∏≠‡∏á‡∏Ç‡∏≠‡∏á', desc: '‡πÄ‡∏•‡πà‡∏ô Quiz ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å', icon: 'üìù', check: (d) => d.quizzes >= 1 },
            { id: 'perfect', name: '‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥', desc: '‡πÑ‡∏î‡πâ 10/10 ‡πÉ‡∏ô Quiz', icon: 'üéØ', check: (d) => d.perfect >= 1 },
            { id: 'streak3', name: '‡πÑ‡∏ü‡πÅ‡∏£‡∏á', desc: 'Streak 3 ‡∏ß‡∏±‡∏ô', icon: 'üî•', check: (d) => d.streak >= 3 },
            { id: 'streak7', name: '‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô', desc: 'Streak 7 ‡∏ß‡∏±‡∏ô', icon: 'üöÄ', check: (d) => d.streak >= 7 },
            { id: 'expert', name: '‡πÇ‡∏õ‡∏£', desc: 'Level Expert', icon: 'üí†', check: (d) => d.xp >= 1000 }
        ];

        /* --- State & Logic --- */
        let state = {
            xp: 0,
            learned: [],
            quizzes: 0,
            perfect: 0,
            streak: 0,
            lastPlay: null,
            achievements: [],
            theme: 'light'
        };

        let currentFlashcard = null;
        let currentFilter = 'all';
        let quizQuestions = [];
        let currentQuizIndex = 0;
        let quizScore = 0;

        // Init
        window.addEventListener('load', () => {
            loadData();
            updateTheme();
            renderProfile();
            loadFlashcard();
            checkStreak();
        });

        /* --- LocalStorage & Helper --- */
        function loadData() {
            const saved = localStorage.getItem('exceljum_data');
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
            }
        }

        function saveData() {
            localStorage.setItem('exceljum_data', JSON.stringify(state));
            renderProfile();
            checkAchievements();
        }

        function showToast(msg) {
            const toast = document.getElementById("toast");
            toast.className = "show";
            toast.innerText = msg;
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2500);
        }

        /* --- Theme --- */
        document.getElementById('theme-toggle').addEventListener('click', () => {
            state.theme = state.theme === 'light' ? 'dark' : 'light';
            updateTheme();
            saveData();
        });

        function updateTheme() {
            document.body.setAttribute('data-theme', state.theme);
        }

        /* --- Navigation --- */
        function switchTab(tabId) {
            document.querySelectorAll('section').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('fade-enter-active');
            });
            
            const target = document.getElementById(`tab-${tabId}`);
            target.classList.remove('hidden');
            // Small animation trigger
            requestAnimationFrame(() => {
                target.classList.add('fade-enter');
                requestAnimationFrame(() => {
                    target.classList.add('fade-enter-active');
                    target.classList.remove('fade-enter');
                });
            });

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Map index to tab logic
            const icons = document.querySelectorAll('.nav-item');
            if(tabId === 'flashcard') icons[0].classList.add('active');
            if(tabId === 'quiz') icons[1].classList.add('active');
            if(tabId === 'parser') icons[2].classList.add('active');
            if(tabId === 'profile') icons[3].classList.add('active');
        }

        /* --- Flashcard Logic --- */
        // Filter logic
        document.querySelectorAll('.filter-chip').forEach(btn => {
            btn.addEventListener('click', (e) => {
                if(btn.parentElement.id === 'category-filters') { // Only for flashcard filters
                    document.querySelectorAll('#category-filters .filter-chip').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.cat;
                    loadFlashcard();
                }
            });
        });

        document.getElementById('flashcard').addEventListener('click', function() {
            this.classList.toggle('flipped');
        });

        function loadFlashcard() {
            const cardEl = document.getElementById('flashcard');
            cardEl.classList.remove('flipped'); // Reset flip

            setTimeout(() => {
                // Filter pool
                let pool = FORMULAS.filter(f => !state.learned.includes(f.id));
                if (currentFilter !== 'all') {
                    pool = pool.filter(f => f.type === currentFilter);
                }

                if (pool.length === 0) {
                    // Check if all learned in category
                    const allInCat = FORMULAS.filter(f => currentFilter === 'all' || f.type === currentFilter);
                    if (allInCat.length > 0 && allInCat.every(f => state.learned.includes(f.id))) {
                        showToast("üéâ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß");
                        // Pick random learned one for review
                        pool = allInCat; 
                    } else {
                         showToast("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ");
                         return;
                    }
                }

                const rand = pool[Math.floor(Math.random() * pool.length)];
                currentFlashcard = rand;

                // Render UI with colors
                const catEl = document.getElementById('fc-category');
                const catInfo = getCategoryStyle(rand.type);
                catEl.style.backgroundColor = catInfo.bg;
                catEl.style.color = catInfo.text;
                catEl.innerText = getTypeThai(rand.type);

                document.getElementById('fc-question').innerText = rand.q;
                document.getElementById('fc-answer').innerText = rand.a;
                document.getElementById('fc-syntax').innerText = rand.syn;
                document.getElementById('fc-desc').innerText = rand.desc;
                document.getElementById('fc-progress').innerText = `${state.learned.length}/50`;
                
            }, 300);
        }

        document.getElementById('btn-forget').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('flashcard').classList.add('flipped'); // Show answer
            setTimeout(loadFlashcard, 1500);
        });

        document.getElementById('btn-remember').addEventListener('click', (e) => {
            e.stopPropagation();
            if (currentFlashcard && !state.learned.includes(currentFlashcard.id)) {
                state.learned.push(currentFlashcard.id);
                addXP(5);
                showToast(`‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! (+5 XP)`);
                saveData();
            } else {
                showToast(`‡∏à‡∏≥‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (Review)`);
            }
            loadFlashcard();
        });

        function getCategoryStyle(type) {
            // Returns css variables based on type mapping
            return {
                bg: `var(--tag-${type}-bg, #eee)`,
                text: `var(--tag-${type}-text, #333)`
            };
        }

        function getTypeThai(type) {
            const map = { 'basic': '‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô', 'lookup': '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'condition': '‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç', 'text': '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', 'datetime': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'math': '‡∏Ñ‡∏ì‡∏¥‡∏ï' };
            return map[type] || type;
        }

        /* --- Quiz Logic --- */
        function startQuiz() {
            document.getElementById('quiz-start').classList.add('hidden');
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-game').classList.remove('hidden');
            
            // Random 10 questions
            quizQuestions = [...FORMULAS].sort(() => 0.5 - Math.random()).slice(0, 10);
            currentQuizIndex = 0;
            quizScore = 0;
            renderQuestion();
        }

        function renderQuestion() {
            const q = quizQuestions[currentQuizIndex];
            document.getElementById('quiz-question').innerText = q.q;
            document.getElementById('quiz-counter').innerText = `${currentQuizIndex + 1}/10`;
            document.getElementById('quiz-bar').style.width = `${((currentQuizIndex) / 10) * 100}%`;
            document.getElementById('quiz-feedback').classList.add('hidden');

            const optsDiv = document.getElementById('quiz-options');
            optsDiv.innerHTML = '';

            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, q.a, btn);
                optsDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btnElement) {
            // Disable all buttons
            document.querySelectorAll('.quiz-option').forEach(b => b.disabled = true);

            const feedback = document.getElementById('quiz-feedback');
            const feedbackText = document.getElementById('quiz-feedback-text');
            feedback.classList.remove('hidden');

            if (selected === correct) {
                btnElement.classList.add('correct');
                quizScore++;
                feedbackText.innerHTML = `<span style="color:var(--primary); font-weight:bold;">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</span> ‡∏Ñ‡∏∑‡∏≠ ${correct}<br>${quizQuestions[currentQuizIndex].desc}`;
            } else {
                btnElement.classList.add('wrong');
                // Highlight correct one
                document.querySelectorAll('.quiz-option').forEach(b => {
                    if (b.innerText === correct) b.classList.add('correct');
                });
                feedbackText.innerHTML = `<span style="color:#c62828; font-weight:bold;">‡∏ú‡∏¥‡∏î!</span> ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠ ${correct}<br><span style="font-family:monospace; background:rgba(0,0,0,0.05); padding:2px 4px; border-radius:4px;">${quizQuestions[currentQuizIndex].syn}</span>`;
            }
        }

        function nextQuestion() {
            currentQuizIndex++;
            if (currentQuizIndex < 10) {
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-game').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            
            document.getElementById('quiz-score-badge').innerText = `${quizScore}/10`;
            const rankText = document.getElementById('quiz-rank-text');
            let xpGain = quizScore * 10;
            
            if (quizScore === 10) {
                rankText.innerText = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ó‡∏û! (Godlike)";
                state.perfect++;
            } else if (quizScore >= 8) {
                rankText.innerText = "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! (Excellent)";
            } else if (quizScore >= 5) {
                rankText.innerText = "‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ (Good Job)";
            } else {
                rankText.innerText = "‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ (Keep Practicing)";
            }

            addXP(xpGain);
            state.quizzes++;
            document.getElementById('quiz-xp-gain').innerText = xpGain;
            saveData();
        }

        function resetQuizUI() {
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-start').classList.remove('hidden');
        }

        /* --- Parser Logic --- */
        function setExample(val) {
            document.getElementById('formula-input').value = val;
        }

        function parseFormula() {
            let raw = document.getElementById('formula-input').value.trim();
            if (!raw) return;
            if (!raw.startsWith('=')) raw = '=' + raw; 
            
            // 1. Identify Functions
            const fnPattern = /([A-Z][A-Z0-9\.]*)(?=\()/gi;
            const matches = [...raw.matchAll(fnPattern)].map(m => m[0].toUpperCase());
            const uniqueFns = [...new Set(matches)];

            // 2. Generate Summary
            const summaryEl = document.getElementById('parser-summary');
            const resultDiv = document.getElementById('parser-result');
            
            resultDiv.classList.remove('hidden');
            
            let mainFn = matches.length > 0 ? matches[0] : '';
            let explanation = "‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ ";
            
            // Special Combo Detection
            if (uniqueFns.includes('INDEX') && uniqueFns.includes('MATCH')) {
                explanation = "‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏≤‡∏ô <span style='color:#5e35b1; font-weight:600;'>INDEX + MATCH</span> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (2-Way Lookup) ‡∏ã‡∏∂‡πà‡∏á‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ VLOOKUP ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ";
            } else if (uniqueFns.includes('IFERROR') && uniqueFns.includes('VLOOKUP')) {
                explanation = "‡πÉ‡∏ä‡πâ <span style='color:#5e35b1; font-weight:600;'>VLOOKUP</span> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö Error ‡∏î‡πâ‡∏ß‡∏¢ <span style='color:#e65100; font-weight:600;'>IFERROR</span> ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            } else if (mainFn) {
                explanation += `<span style='color:var(--primary); font-weight:600;'>${mainFn}</span> (${PARSER_DB[mainFn] || '‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô'}) ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å`;
            } else {
                explanation = "‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ";
            }
            summaryEl.innerHTML = explanation;

            // 3. Tree View Construction
            const treeEl = document.getElementById('parser-tree');
            treeEl.innerHTML = renderTree(raw);
        }

        function renderTree(formula) {
            if (formula.startsWith('=')) formula = formula.substring(1);
            
            let html = '';
            let indent = 0;
            let buffer = '';
            
            for (let i = 0; i < formula.length; i++) {
                const char = formula[i];
                
                if (char === '(') {
                    html += `<div class="tree-line" style="margin-left:${indent * 20}px;"><span style="color:var(--primary); font-weight:600;">${buffer}</span></div>`;
                    buffer = '';
                    indent++;
                } else if (char === ')') {
                    if (buffer.trim()) html += `<div class="tree-line" style="margin-left:${indent * 20}px;">${buffer}</div>`;
                    buffer = '';
                    indent--;
                } else if (char === ',') {
                    if (buffer.trim()) html += `<div class="tree-line" style="margin-left:${indent * 20}px;">${buffer}</div>`;
                    buffer = '';
                } else {
                    buffer += char;
                }
            }
            if (buffer.trim()) html += `<div class="tree-line" style="margin-left:${indent * 20}px;">${buffer}</div>`;
            return html;
        }

        /* --- Profile & Gamification --- */
        function addXP(amount) {
            state.xp += amount;
        }

        function getLevel(xp) {
            for (let i = LEVELS.length - 1; i >= 0; i--) {
                if (xp >= LEVELS[i].xp) return LEVELS[i];
            }
            return LEVELS[0];
        }

        function getNextLevel(xp) {
            for (let i = 0; i < LEVELS.length; i++) {
                if (xp < LEVELS[i].xp) return LEVELS[i];
            }
            return null;
        }

        function checkStreak() {
            const today = new Date().toLocaleDateString();
            if (state.lastPlay !== today) {
                // Check if yesterday played
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (state.lastPlay === yesterday.toLocaleDateString()) {
                    state.streak++;
                } else {
                    state.streak = 1; // Reset or Start
                }
                state.lastPlay = today;
                saveData();
            }
        }

        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (!state.achievements.includes(ach.id) && ach.check(state)) {
                    state.achievements.push(ach.id);
                    showToast(`üèÜ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ: ${ach.name}`);
                }
            });
        }

        function renderProfile() {
            const lvl = getLevel(state.xp);
            const nextLvl = getNextLevel(state.xp);
            
            document.getElementById('profile-badge').innerText = lvl.icon;
            document.getElementById('profile-level').innerText = `Level: ${lvl.name}`;
            document.getElementById('profile-xp').innerText = state.xp;
            
            if (nextLvl) {
                document.getElementById('profile-next-xp').innerText = nextLvl.xp;
                const progress = ((state.xp - lvl.xp) / (nextLvl.xp - lvl.xp)) * 100;
                document.getElementById('xp-bar').style.width = `${Math.max(0, Math.min(100, progress))}%`;
            } else {
                document.getElementById('profile-next-xp').innerText = 'MAX';
                document.getElementById('xp-bar').style.width = '100%';
            }

            document.getElementById('stat-learned').innerText = state.learned.length;
            document.getElementById('stat-streak').innerText = state.streak;

            const grid = document.getElementById('achievement-grid');
            grid.innerHTML = '';
            ACHIEVEMENTS.forEach(ach => {
                const isUnlocked = state.achievements.includes(ach.id);
                const el = document.createElement('div');
                el.className = `achievement-item ${isUnlocked ? 'unlocked' : ''}`;
                el.style.cssText = `aspect-ratio:1; border-radius:16px; background:${isUnlocked ? 'var(--tag-basic-bg)' : 'var(--surface-variant)'}; display:flex; align-items:center; justify-content:center; font-size:24px; opacity:${isUnlocked ? 1 : 0.3}; filter:grayscale(${isUnlocked ? 0 : 1}); transition:all 0.3s;`;
                el.innerHTML = ach.icon;
                el.title = `${ach.name}: ${ach.desc}`;
                if (isUnlocked) {
                    el.onclick = () => showToast(`${ach.name}: ${ach.desc}`);
                }
                grid.appendChild(el);
            });
        }
        
        function resetData() {
            if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? (XP ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ)')) {
                state = {
                    xp: 0,
                    learned: [],
                    quizzes: 0,
                    perfect: 0,
                    streak: 0,
                    lastPlay: null,
                    achievements: [],
                    theme: state.theme
                };
                saveData();
                showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                setTimeout(() => location.reload(), 1000);
            }
        }
    </script>
</body>
</html>